(function() {
    'use strict';

    angular
        .module('xpacswebApp')
        .controller('ViewImageStudiesController', ViewImageStudiesController);

    ViewImageStudiesController.$inject = ['$resource','AlertService', '$stateParams', 'DownloadService'];

    function ViewImageStudiesController($resource, AlertService, $stateParams, DownloadService) {
        var vm = this;
        
        vm.studies = $resource('api/view-image-studies').query(onSuccess, onError); // query is the default GET with return array
        
        function onSuccess(data, headers) {
        		// this error can be generated by the download dialog box when user clicked CANCEL button
        		if( $stateParams.error ) {
        			AlertService.error($stateParams.error);
        			return;
        		}
        		
        		if( $stateParams.fileToDownload ) { 
        			DownloadService.get(
        					$stateParams.fileToDownload.folder, 
        					$stateParams.fileToDownload.id + ".zip");
        		}
        }
        
        function onError(error) {
            AlertService.error(error.data.message);
        }        
        
    }
})();
